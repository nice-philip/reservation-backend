<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì„±í˜• Â· í”¼ë¶€ ì‹œìˆ  ì˜ˆì•½</title>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background: #f9f9f9;
            padding: 20px;
            color: #333;
        }
        
        h1,
        h2 {
            text-align: center;
        }
        
        .home-link {
            display: block;
            text-align: center;
            margin-bottom: 20px;
            color: #0077cc;
            text-decoration: none;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }
        
        .card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: scale(1.03);
        }
        
        .card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        
        .card p {
            padding: 10px;
            font-weight: bold;
        }
        
        label,
        input,
        select,
        textarea {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            font-size: 15px;
        }
        
        button {
            padding: 12px;
            width: 100%;
            background: #0077cc;
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        
        #form-section {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 20px auto;
            display: none;
        }
        
        .accordion {
            margin-top: 20px;
            border-top: 1px solid #ccc;
        }
        
        .accordion button {
            background: #eee;
            width: 100%;
            text-align: left;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            outline: none;
        }
        
        .accordion-content {
            padding: 10px;
            display: none;
            background: #fafafa;
            border-bottom: 1px solid #ddd;
        }
        
        .zoomable {
            max-width: 100%;
            cursor: zoom-in;
            transition: transform 0.3s;
        }
        
        .zoomable.zoomed {
            transform: scale(3);
            cursor: zoom-out;
            z-index: 9999;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(3);
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        
        #procedure-display {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-wrap: wrap;
        }
        
        #procedure-description {
            flex: 1;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>

    <h1>ì„±í˜• Â· í”¼ë¶€ ì‹œìˆ  ì˜ˆì•½</h1>
    <a href="/" class="home-link">â† í™ˆìœ¼ë¡œ</a>

    <div class="grid" id="category-grid">
        <div class="card" onclick="loadForm('ì˜ë ì„±í˜•')"><img src="1.jpg" />
            <p>ì˜ë ì„±í˜•</p>
        </div>
        <div class="card" onclick="loadForm('ë¦¬í”„íŒ…')"><img src="2.jpg" />
            <p>ë¦¬í”„íŒ…</p>
        </div>
        <div class="card" onclick="loadForm('ìŠ¤í‚¨ì¼€ì–´')"><img src="3.jpg" />
            <p>ìŠ¤í‚¨ì¼€ì–´</p>
        </div>
        <div class="card" onclick="loadForm('ë¯¸ë°±ê´€ë¦¬')"><img src="4.jpg" />
            <p>ë¯¸ë°±ê´€ë¦¬</p>
        </div>
        <div class="card" onclick="loadForm('ë ˆì´ì € ì‹œìˆ ')"><img src="5.jpg" />
            <p>ë ˆì´ì € ì‹œìˆ </p>
        </div>
        <div class="card" onclick="loadForm('ì œëª¨')"><img src="6.jpg" />
            <p>ì œëª¨</p>
        </div>
        <div class="card" onclick="loadForm('íŠ¸ëŸ¬ë¸” ê´€ë¦¬')"><img src="7.jpg" />
            <p>íŠ¸ëŸ¬ë¸” ê´€ë¦¬</p>
        </div>
        <div class="card" onclick="loadForm('ìŠ¤í‚¨ë¶€ìŠ¤í„°')"><img src="8.jpg" />
            <p>ìŠ¤í‚¨ë¶€ìŠ¤í„°</p>
        </div>
        <div class="card" onclick="loadForm('ì²´í˜•ê´€ë¦¬')"><img src="9.jpg" />
            <p>ì²´í˜•ê´€ë¦¬</p>
        </div>
        <div class="card" onclick="loadForm('ìƒë‹´ ì˜ˆì•½')"><img src="10.jpg" />
            <p>ìƒë‹´ ì˜ˆì•½</p>
        </div>
    </div>

    <div id="form-section">
        <h2 id="form-title">ì˜ˆì•½</h2>
        <label>ì´ë¦„</label><input type="text" id="name" />
        <label>ë‚˜ì´</label><input type="number" id="age" />
        <label>ì„±ë³„</label><input type="text" id="gender" />
        <label>ì´ë©”ì¼</label><input type="email" id="email" />
        <label>ë‚ ì§œ</label><input type="date" id="date" />
        <label>ì‹œê°„</label><input type="time" id="time" />
        <label>ìš”ì²­ì‚¬í•­</label><textarea id="main-request"></textarea>
        <label>ë¹„ê³ </label><textarea id="note"></textarea>
        <label>íšŒì› í™•ì¸ìš© ë²ˆí˜¸ ë˜ëŠ” í…ìŠ¤íŠ¸</label><input type="text" id="memberKey" placeholder="ì˜ˆ: 01012345678 ë˜ëŠ” ì‚¬ìš©ìID" />
        <button onclick="submitForm()">ì˜ˆì•½ ì •ë³´ ì €ì¥</button>

        <div class="accordion">
            <button onclick="toggleAccordion(this)">ğŸ–¼ï¸ ì‹œìˆ  ì´ë¯¸ì§€ ë° ì„¤ëª… ë³´ê¸°</button>
            <div class="accordion-content">
                <div id="procedure-display">
                    <img id="procedure-image" class="zoomable" src="" alt="ì‹œìˆ  ì´ë¯¸ì§€" style="max-width: 300px;" />
                    <div id="procedure-description">ì„¤ëª… ë¡œë”© ì¤‘...</div>
                </div>
            </div>
        </div>

        <div id="paypal-button-container" style="margin-top:20px;"></div>
    </div>

    <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>
    <script>
        let selectedCategory = '';

        function loadForm(category) {
            selectedCategory = category;
            document.getElementById('category-grid').style.display = 'none';
            document.getElementById('form-title').innerText = `${category} ì˜ˆì•½`;
            document.getElementById('form-section').style.display = 'block';

            const imagePath = `${category}/1.jpg`;
            const textPath = `${category}/1.txt`;

            document.getElementById('procedure-image').src = imagePath;

            fetch(textPath)
                .then(res => res.text())
                .then(text => {
                    document.getElementById('procedure-description').innerText = text;
                })
                .catch(() => {
                    document.getElementById('procedure-description').innerText = 'ì„¤ëª…ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                });

            document.getElementById('paypal-button-container').innerHTML = '';
            paypal.Buttons({
                createOrder: (data, actions) => {
                    return actions.order.create({
                        purchase_units: [{
                            description: `${category} ì‹œìˆ  ì˜ˆì•½`,
                            amount: {
                                value: '20.00'
                            }
                        }]
                    });
                },
                onApprove: (data, actions) => {
                    return actions.order.capture().then(details => {
                        alert(details.payer.name.given_name + 'ë‹˜, ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        submitForm();
                    });
                },
                onError: (err) => {
                    console.error('PayPal ì˜¤ë¥˜:', err);
                    alert('ê²°ì œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }).render('#paypal-button-container');
        }

        function submitForm() {
            const payload = {
                category: selectedCategory,
                name: document.getElementById('name').value,
                age: parseInt(document.getElementById('age').value),
                gender: document.getElementById('gender').value,
                email: document.getElementById('email').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                mainRequest: document.getElementById('main-request').value,
                note: document.getElementById('note').value,
                memberKey: document.getElementById('memberKey').value.trim(),
                savedAt: new Date().toISOString()
            };

            fetch('https://reservation-server-t8d6.onrender.com/api/reservations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                })
                .then(res => res.json())
                .then(data => {
                    alert('ì˜ˆì•½ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                })
                .catch(err => {
                    console.error(err);
                    alert('ì˜ˆì•½ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                });
        }

        function toggleAccordion(btn) {
            const content = btn.nextElementSibling;
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
        }

        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('zoomable')) {
                e.target.classList.toggle('zoomed');
            }
        });
    </script>
</body>

</html>